---
layout:     post             # layout, do not alter
title:      校招准备          # title
subtitle:   网络		    # subtitle
date:       2018-8-21         # time
author:     xSun             # author
header-img: img/DSC_4446.jpg  #bg image
catalog: true                # catalog or not
tags:                        #tags
    - 校招
    - 网络
---

> 这几个月来，一直在准备校招，零零碎碎的从各个渠道也总结了很多知识点，现在进行一下整理，一方面是对自己的交代，另一方面也希望可以给别人提供参考。

# 网络基础

## TCP建立、断开链接

### TCP建立链接

TCP经过三次握手建立链接，具体的流程如下图所示。

![TCP三次握手]https://site-images-1256908946.cos.ap-shanghai.myqcloud.com/%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B.png)

#### 为什么要三次握手？

采用三次握手是为了防止失效的连接请求报文段突然又传送到主机B，因而产生错误。

失效的连接请求报文段是指：主机A发出的连接请求没有收到主机B的确认，于是经过一段时间后，主机A又重新向主机B发送连接请求，且建立成功，顺序完成数据传输。考虑这样一种特殊情况，主机A第一次发送的连接请求并没有丢失，而是因为网络节点导致延迟达到主机B，主机B以为是主机A又发起的新连接，于是主机B同意连接，并向主机A发回确认，但是此时主机A根本不会理会，主机B就一直在等待主机A发送数据，导致主机B的资源浪费。 

采用两次握手不行，原因就是上面说的失效的连接请求的特殊情况。

### TCP断开链接

TCP断开链接需要四次挥手，具体流程如下图。

![四次挥手](https://site-images-1256908946.cos.ap-shanghai.myqcloud.com/%E5%9B%9B%E6%AC%A1%E6%8C%A5%E6%89%8B.png)

**发送了FIN只是表示这端不能继续发送数据(应用层不能再调用send发送)，但是还可以接收数据。**收到一个
FIN只意味着这一方向上没有数据流动，一个TCP连接在收到一个FIN后仍能发送数据，比如：如主机A收到主机B的FIN断开TCP连接请求，只是表示主机B已经发送完数据，主机A收到FIN后作出应答，并终止这个方向的数据传输，此时处于**半关闭状态。**但是主机A仍然可以发送数据的，只有当主机A发送完数据并发送FIN给主机B时，主机B才停止这个方向的数据传输，并关闭TCP连接。

#### 为什么建立链接需要三次握手，而断开链接需要四次挥手？

**保证两边都发送完了所有的包**。因为每个方向都需要一个FIN和ACK，当一端发送了FIN包之后，处于半关闭状态，此时仍然可以接收数据包。 **在建立连接时，服务器可以把SYN和ACK放在一个包中发送。** 但是在断开连接时，如果一端收到FIN包，但此时仍有数据未发送完，此时就需要先向对端回复FIN包的ACK。等到将剩下的数据都发送完之后，再向对端发送FIN，断开这个方向的连接。  

因此很多时候FIN和ACK需要在两个数据包中发送，因此需要四次握手。 

---

## TCP中的定时器

### 建立连接计时器

在建立连接发送SYN时，会启动一个计时器(3秒)，如果对方没有应答，可能因为SYN丢失，那么会在3秒以后重新发送SYN包。

### 重传计时器

TCP正常传输过程中，发送包时将其缓存，并启动计时器，如果在计时器结束时间内正确收到对方的应答，则将原先缓存的数据包丢弃，发送下一次的seq包，重新启动计时器。如果在计时器结束时还没有收到对方的正确应答，则将缓存的包再次重发，并重新启动计时器。

### 延迟应答计时器

当收到对方的数据包时，并不是立即给对方恢复ACK，而是延迟等待一段时间(200ms)，这段时间内如果有要发送给对方的数据包，那么此ACK就可以和要发送的数据包一起发送给对方。可以提高网络传输效率。

### 坚持计时器

使用滑动窗口可以控制接收方的流量，当窗口大小为0时，接收方不在接收数据包。当窗口变为非0时，会发送ACK给发送方，但如果ACK丢失，二者就会互相等待而死锁。因此，**发送方使用坚持计时器周期的向接收方发送窗口探测的报文，查询接收方的窗口是否已经非0。**

### 保活计时器

在TCP建立连接时指定了SO_KEEPALIVE时，保活计时器启用。如果服务器和客户端长时间没有交互，需要使用保活计时器来判定对方是否还活着。

### FIN_WAIT_2计时器

当TCP断开连接第2次握手后，即主动关闭方向被动关闭方发送FIN，并且收到了对方的ACK，此时进入TIME_WAIT_2状态，主动关闭方等待对方的FIN，以便完全关闭连接。这时主动关闭方启动FIN_WAIT_2计时器，**如果在这么长时间内都没有收到对方的FIN，则主动释放连接。**

### TIME_WAIT计时器

当主动关闭方收到对方的FIN后，给对方发送ACK，启动TIME_WAIT计时器，这段时间时候才进入CLOSE状态。没有立即进入CLOSE**因为有可能对方没有收到ACK而重发FIN，所以要等待一段时间。**

[参考链接][2]

---

## TCP协议DDOS

### SYN flooding
向服务器发送大量的syn包，**使服务器处于大量的半连接状态，**缺少三次握手的最后一步，而使得服务器资源被耗尽。而正常的访问请求不能得到处理。

- 解决方式：
  - 使用防火墙的SYN Proxy功能，限制单位时间内通过的SYN包。但在流量较大时，出现延迟
  - 随机丢弃，在服务器负载较重时，随机丢弃部分连接，减缓服务器的负载，会使得连接的成功率降低
  - SYN cookie，为请求建立syn的IP地址建立cookie，如果带线大量的syn则判断为攻击，但是依赖于真       实的IP地址。

### ACK flooding 

攻击者向服务器发送大量的ACK报文，服务器忙于处理大量凭空出现的第三次握手的报文，导致资源耗尽，无法响应正常请求。

### 资源耗尽型

攻击者与被攻击目标完成三次握手后，立刻发送FIN或RST报文，释放本端连接，同时快速发起新的连接，以此来消耗被攻击目标的系统资源。华为Anti-DDoS解决方案通过检查新建连接的速率来防御此类攻击。

攻击者与被攻击目标完成三次握手后，发送很少的报文来维持连接状态，通过这种异常的TCP连接来消耗被攻击目标的系统资源。

### 异常报文

六个标志位在TCP交互过程中各司其职，标志位置1与否必须严格遵循TCP协议规范。如果不遵循规范随意将标志位置0或置1，这类报文就称为TCP异常报文。接收方处理这些异常报文时会消耗系统资源，甚至可能会导致系统崩溃。攻击者也可以利用TCP异常报文来发起DDoS攻击，向被攻击目标发送大量的构造的TCP异常报文，导致被攻击目标系统资源耗尽、网络拥塞，无法正常提供服务。

[参考链接][3]

---

## 各种协议

### 基于TCP、UDP的协议

- TCP：Telnet，FTP，SMTP，HTTP...

- UDP：NFS，DNS，SNMP，TFTP，RIP...

### 各层协议

|  层级  |        协议         |
| :----: | :-----------------: |
| 应用层 |      HTTP，FTP      |
| 传输层 |      TCP，UDP       |
| 网络层 | ICMP，IGMP，IP，ARP |

VPN协议在很多层都有，虚拟专用网VPN， 数据链路层VPN， 网络层VPN，  SSL‐VPN。

---

## HTTP，HTTPS

### HTTPS用到的技术：

- 非对称加密算法用于在握手过程中加密生成的密码

- 对称加密算法用于对真正传输的数据进行加密

- HASH算法用于验证数据的完整性。

非对称加密算法会生成公钥和私钥，公钥只能用于加密数据，因此可以随意传输，而网站的私钥用于对数据进行解密，所以网站都会非常小心的保管自己的私钥，防止泄漏。

### HTTP 与 HTTPS的区别

1. https协议需要到ca申请证书，一般免费证书较少，因而需要一定费用。

2. http是超文本传输协议，信息是明文传输，https则是具有安全性的ssl加密传输协议。

3. http和https使用的是完全不同的连接方式，用的端口也不一样，前者是80，后者是443。

4. http的连接很简单，是无状态的；HTTPS协议是由SSL+HTTP协议构建的可进行加密传输、身份认证的网络协议，比http协议安全。

### 在浏览器中输入www.baidu.com后执行的全部过程

1. 客户端浏览器通过DNS解析到www.baidu.com的IP地址220.181.27.48，通过这个IP地址找到客户端到服务器的路径。客户端浏览器发起一个HTTP会话到220.161.27.48，然后通过TCP进行封装数据包，输入到网络层。 

2. 在客户端的传输层，把HTTP会话请求分成报文段，添加源和目的端口，如服务器使用80端口监听客户端的请求，客户端由系统随机选择一个端口如5000，与服务器进行交换，服务器把相应的请求返回给客户端的5000端口。然后使用IP层的IP地址查找目的端。 

3. 客户端的网络层不用关心应用层或者传输层的东西，主要做的是通过查找路由表确定如何到达服务器，期间可能经过多个路由器，这些都是由路由器来完成的工作，我不作过多的描述，无非就是通过查找路由表决定通过那个路径到达服务器。 

4. 客户端的链路层，包通过链路层发送到路由器，通过邻居协议查找给定IP地址的MAC地址，然后发送ARP请求查找目的地址，如果得到回应后就可以使用ARP的请求应答交换的IP数据包现在就可以传输了，然后发送IP数据包到达服务器的地址。

[参考链接][4]

---

[^_^]: refs here:

[1]:http://www.xsun24.top/
[2]:https://blog.csdn.net/hyman_yx/article/details/52086389
[3]:http://forum.huawei.com/enterprise/zh/thread-375039-1-1.html
[4]:https://www.nowcoder.com/test/question/done?tid=14960069&amp;qid=25771#summary


