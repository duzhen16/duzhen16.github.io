---
layout:     post             # layout, do not alter
title:      鏍℃嫑鍑嗗          # title
subtitle:   C/C++鍩虹锛�1锛�    # subtitle
date:       2018-8-17         # time
author:     xSun             # author
header-img: img/DSC_4446.jpg  #bg image
catalog: true                # catalog or not
tags:                        #tags
    - 鏍℃嫑
    - C/C++
---

> 杩欏嚑涓湀鏉ワ紝涓€鐩村湪鍑嗗鏍℃嫑锛岄浂闆剁纰庣殑浠庡悇涓笭閬撲篃鎬荤粨浜嗗緢澶氱煡璇嗙偣锛岀幇鍦ㄨ繘琛屼竴涓嬫暣鐞嗭紝涓€鏂归潰鏄鑷繁鐨勪氦浠ｏ紝鍙︿竴鏂归潰涔熷笇鏈涘彲浠ョ粰鍒汉鎻愪緵鍙傝€冦€�

## 鍩虹

### 杩涚▼鍦板潃绌洪棿甯冨眬
浠�32浣嶄负渚嬶紝杩涚▼鐨勭敤鎴峰湴鍧€绌洪棿甯冨眬澶ц嚧濡備笅鍥炬墍绀恒€�
![process_space](http://p194hb5ge.bkt.clouddn.com/process_space.jpg)
[鍙傝€冮摼鎺[2]

娈祙璇存槑
:----:|:------------------------------------:
BSS |	闈欐€佸瓨鍌ㄥ尯鐨勪竴閮ㄥ垎锛岀敤鏉ュ瓨鏀炬湭鍒濆鍖栫殑鍏ㄥ眬鍙橀噺
鏁版嵁娈祙	闈欐€佸瓨鍌ㄥ尯鐨勪竴閮ㄥ垎锛岀敤鏉ュ瓨鍌ㄥ凡鍒濆鍖栫殑鍏ㄥ眬鍙橀噺鍜宻tatic澹版槑鐨勫彉閲�
浠ｇ爜娈祙瀛樻斁绋嬪簭浠ｇ爜鐨勫唴瀛樺尯锛屼负绋嬪簭浠ｇ爜鍦ㄥ唴瀛樹腑鐨勬槧灏�
鍫唡	涓哄彉閲忓姩鎬佸垎閰嶅唴瀛樼殑鍖哄煙锛屽爢鍖哄ぇ灏忎笉鍥哄畾
鏍坾瀛樻斁绋嬪簭鐨勫眬閮ㄥ彉閲忓拰褰㈠弬锛屽嚱鏁拌皟鐢ㄦ椂鏍堢敤鏉ヤ紶閫掑弬鏁板拰杩斿洖鍊�
鍔ㄦ€佸瓨鍌ㄥ尯|鍫嗭紝鏍�
闈欐€佸瓨鍌ㄥ尯|BSS锛屾暟鎹

鏌ョ湅杩涚▼鍦板潃鏄犲皠鍙互浣跨敤 **cat /proc/pid/maps**鍛戒护锛屽嵆灏辨槸鏌ョ湅maps鏂囦欢锛屽彲浠ョ湅鍒版杩涚▼鎵€鍏宠仈鐨剉ma鐨勬儏鍐碉紝鍖呮嫭鍦板潃鑼冨洿锛岃鍙栨潈闄愶紝鏄犲皠鏂囦欢绛夈€傚涓嬪浘锛�

![process_maps](http://p194hb5ge.bkt.clouddn.com/process_maps.png)

**鐢辫緭鍑哄苟缁撳悎涓婂浘鍙煡锛屽鏋滃湪绋嬪簭閲岃闂甆ULL鎸囬拡锛屼細浜х敓core dump锛屽洜涓哄湪杩涚▼鍦板潃绌洪棿涓璠0, 400000]姝ゆ涓烘湭鏄犲皠锛屼笉灞炰簬璇ヨ繘绋嬪湴鍧€绌洪棿鍐呫€�**

> 濡傛灉浜х敓coredump锛屽彲浠ヤ娇鐢╣db杩涜璋冭瘯銆傞鍏堥渶瑕佷娇鐢ㄥ懡浠ulimit -c unlimited`浣垮緱绯荤粺浜х敓coredump鏂囦欢锛岀劧鍚庣洿鎺ヤ娇鐢╜gdb ./coredumpfilename`杩涚▼璋冭瘯鍗冲彲锛屽彲浠ユ壘鍒板彂鐢焥egment fault鐨勪綅缃瓑銆�

闈欐€佸彉閲忥紙闈欐€佸眬閮ㄥ彉閲忥紝闈欐€佸叏灞€鍙橀噺锛夊拰鍏ㄥ眬鍙橀噺閮戒綅浜�**闈欐€佸瓨鍌ㄥ尯**锛屼粬浠殑鍏卞悓鐗圭偣鏄敓瀛樺懆鏈熻疮绌夸簬鐪熶釜绋嬪簭鎵ц杩囩▼銆傚尯鍒湪浜庝綔鐢ㄨ寖鍥翠笉鍚岋紝鍏ㄥ眬鍙橀噺鍙綔鐢ㄤ簬鎵€鏈夌殑鍑芥暟锛岄潤鎬佸彉閲忓彧鑳界敤浜庢墍瀹氫箟鐨勫嚱鏁般€�

**int 鍨嬪叏灞€鍙橀噺锛岄潤鎬佸眬閮ㄥ彉閲忕殑鍒濆鍊奸兘涓�0銆�
int鍨嬬殑灞€閮ㄥ彉閲忕殑鍒濆鍊间负闅忔満鍊笺€�
瑕佸湪涓€涓枃浠朵腑浣跨敤涓庡眬閮ㄥ彉閲忓悓鍚嶇殑鍏ㄥ眬鍙橀噺锛岄渶瑕佸姞涓婏細锛�**



```
#include <stdio.h>
int BSS; //瀛樺偍鍦˙SS鍖�
Static char * p; // BSS
int data = 10; //瀛樺偍鍦ㄦ暟鎹锛屽叾浠栨枃浠朵腑鍙娇鐢� extern 澹版槑
Static char * q = "abc"; 
//q鍦ㄦ暟鎹尯锛屸€渁bc"鍦ㄦ枃鏈父閲忓尯锛屽€间笉鑳戒慨鏀�, 浣滅敤鍩熷彧鍦ㄦ湰鏂囦欢鍐�
int main
{
	static int a = 20; //瀛樺偍鍦ㄦ暟鎹
	int x, y; // 瀛樺偍鍦ㄦ爤涓�
	char *p = (char *)malloc(20); //瀛樺偍鍦ㄥ爢涓�
	int b = foo(x,y); //鐢ㄦ爤杩涜鍙傛暟浼犻€�
	int data = 30;
	printf("%d\n",::data); //璁块棶涓庡眬閮ㄥ彉閲忓悓鍚嶅叏灞€鍙橀噺
	free(p);
	return 0;
}
int foo( int x, int y)
{
	int b = x + y;
	return b; // 杩斿洖鍊煎瓨鍌ㄥ湪eax瀵勫瓨鍣ㄤ腑
}

```
---

## 鍫� & 鏍�
鏍堝尯(stack) -- 鐢辩紪璇戝櫒鑷姩鍒嗛厤鍜岄噴鏀撅紝瀛樻斁鍑芥暟鐨勫弬鏁板€硷紝灞€閮ㄥ彉閲忕殑鍊肩瓑銆傚叾鎿嶄綔鏂瑰紡绫讳技浜庢暟鎹粨鏋勪腑鐨勬爤銆�

鍫嗗尯(heap) -- 涓€鑸敱绋嬪簭鍛樺垎閰嶅拰閲婃斁锛岃嫢绋嬪簭鍛樹笉閲婃斁锛岀▼搴忕粨鏉熸椂鍙兘鐢監S鍥炴敹锛屾敞鎰忓畠涓庢暟鎹粨鏋勪腑鐨勫爢鏄袱鍥炰簨锛屽垎閰嶆柟寮忓€掓槸绫讳技浜庨摼琛ㄣ€�

### 鍫嗐€佹爤鍖哄埆
- 鎸夌鐞嗘柟寮� 
	- 鏍堟槸绯荤粺缂栬瘧鍣ㄥ惎鍔ㄧ鐞嗭紝涓嶉渶瑕佺▼搴忓憳鎵嬪姩绠＄悊
	- 鍫嗙殑閲婃斁鐢辩▼搴忓憳鎵嬪姩绠＄悊锛屼笉鍙婃椂鍥炴敹瀹规槗浜х敓鍐呭瓨娉勯湶
- 鎸夊垎閰嶆柟寮� 
	- 鏍堥潤鎬佸垎閰嶆槸绯荤粺缂栬瘧鍣ㄥ畬鎴愮殑锛屾瘮濡傚眬閮ㄥ彉閲忕殑鍒嗛厤
	- 鍫嗘槸鍔ㄦ€佸垎閰嶅拰鍥炴敹鍐呭瓨鐨勶紝娌℃湁闈欐€佸垎閰嶇殑鍫�
- 鎸夊垎閰嶅ぇ灏� 
	- 鏍堟槸鍚戜綆鍦板潃鎵╁睍鐨勬暟鎹粨鏋勶紝鏄竴鍧楄繛缁殑鍐呭瓨鍖哄煙
   - 鍫嗘槸鍚戦珮鍦板潃鎵╁睍鐨勬暟鎹粨鏋勶紝鏄笉杩炵画鐨勫唴瀛樺尯鍩�

> > 濡備綍婧㈠嚭鏍堬紵
 1. 閫掑綊鍑芥暟鏃犻檺閫掑綊
 2. 浣跨敤澶х粨鏋勭殑灞€閮ㄥ彉閲�

---

## const鍏抽敭瀛�
`const`涓哄彧璇诲叧閿瓧锛屼慨楗扮殑閭ｄ釜閮ㄥ垎鏄彧璇荤殑銆�

```
e.g.
int a = 10;
const int * p = &a; 琛ㄧずp鎸囧悜閲廰涓哄彧璇� 搴曞眰const
int const * p = &a; 鍚屼笂
int * const p = &a; 琛ㄧず鎸囬拡p涓哄彧璇�  椤跺眰const
const int* const d  鎸囬拡鍜屾寚鍚戠殑鍐呭瓨鍖猴紝浜岃€呴兘鏄彧璇荤殑
```
### C++甯搁噺鎶樺彔

```
const int i = 0;
int *j = (int *)&i;
*j = 1;
cout << i << " " << *j << endl;

output:
0 1
```
C++涓紝const鍙橀噺(鍗冲父閲�)鍊兼斁鍦ㄧ紪璇戝櫒鐨勭鍙疯〃涓紝璁＄畻鏃剁紪璇戝櫒鐩存帴浠庤〃涓彇鍊硷紝鑰屼笉鏄闂唴瀛橈紝鐪佸幓浜嗚闂唴瀛樼殑鏃堕棿锛岃繖涔熷氨鏄墍璋撶殑缂栬瘧鍣ㄤ紭鍖栥€備娇鐢╜volatile`鍏抽敭瀛椾細寮哄埗浠庡唴瀛樹腑鍙栧€硷紝鑰屼笉浣跨敤缂栬瘧鍣ㄧ殑浼樺寲銆�

---

## sizeof鍏抽敭瀛�
sizeof聽杩斿洖鐨勫€艰〃绀虹殑鍚箟濡備笅锛堝崟浣嶅瓧鑺傦級:

绫诲埆|澶у皬
:---:|:---:
鏁扮粍 | 缂栬瘧鏃跺垎閰嶇殑鏁扮粍鐨勫唴瀛樺ぇ灏徛�
鎸囬拡 | 瀛樺偍璇ユ寚閽堟墍鐢ㄧ殑绌洪棿澶у皬锛�32浣嶆槸4锛�64浣嶆槸8锛�
褰㈠弬涓殑鏁扮粍鍚� | 鍚屾寚閽�
绫宦�  | 璇ョ被鍨嬫墍鍗犵殑绌洪棿澶у皬锛屼笉鍖呮嫭鍑芥暟锛屽彧鐪嬫垚鍛樺彉閲忓強铏氬嚱鏁版寚閽埪�
瀵硅薄聽|聽瀵硅薄鐨勫疄闄呭崰鐢ㄧ┖闂村ぇ灏忥紙鑰冭檻4/8瀛楄妭瀵瑰叾锛�
鍑芥暟聽| 鍑芥暟鐨勮繑鍥炵被鍨嬫墍鍗犵殑绌洪棿澶у皬銆傚嚱鏁扮殑杩斿洖绫诲瀷涓嶈兘鏄痸oid聽

```
绌虹被锛�
class CBase{
};
sizeof(CBase) == 1;
```
銆婃繁搴︽帰绱++瀵硅薄妯″瀷銆嬩腑鏄繖鏍疯鐨勶細閭ｆ槸琚紪璇戝櫒鎻掕繘鍘荤殑涓€涓猚har锛屼娇寰楄繖涓猚lass鐨勪笉鍚屽疄浣擄紙object锛夊湪鍐呭瓨涓厤缃嫭涓€鏃犱簩鐨勫湴鍧€銆備篃灏辨槸璇磋繖涓猚har鏄敤鏉ユ爣璇嗙被鐨勪笉鍚屽璞＄殑銆�

---


[^_^]: refs here:

[1]:http://www.xsun24.top/
[2]:http://www.cnblogs.com/clover-toeic/p/3754433.html
